---
title: "Dashboard Project Name Here" 
output:
  flexdashboard::flex_dashboard:
    orientation: rows
runtime: shiny
---
    
    
```{r setup, include=FALSE, warning=FALSE}

# Flexdashboard documentation--- https://rmarkdown.rstudio.com/flexdashboard/index.html

# This template is setup to include interactive Shiny elements. Examples can be in the Shiny section at https://rmarkdown.rstudio.com/flexdashboard/shiny.html#using_shiny



#------------------------------ Load Packages ----------------------------------------
library(flexdashboard)
library(tidyverse)
library(readxl)
library(knitr)
library(kableExtra)
library(shiny)
library(DT)

```


```{r data, include=FALSE}

#---------------------------------- Data Import ----------------------------------------
data_import <- read_xlsx("../data/isoqol_data.xlsx")



#---------------------------------- Data Transformations --------------------------------
data <- data_import %>% 
  mutate(tx_start_dt = as.Date(tx_start_dt), 
         tx_end_dt = as.Date(tx_end_dt),
         enroll_dt = as.Date(enroll_dt))      
  
# YOUR CODE HERE


```


About
======================================================================
    
    
#### __Add Study Title Here__  


__Status__:	Activated   
__First Enrollment Date:__ 01/04/2022 

__Projected Number of Patients__:	75  
__Current Accrual__: `r n_distinct(data$case)`


<hr>
    
#### Purpose of Study     
This is a great place to describe your study or copy and paste key information straight from the study protocol.


    

Cohort  
======================================================================  

Inputs {.sidebar}   
---------------------------------------   
 
<hr>    
    
__Use filters below to subset cohort__     
```{r}

#---------------- Insert Shiny Filters ----------------------

# Filter by Enrollment Site
selectInput("enroll_site", 
            label = "Enrollment site",
            choices = c("All","ARZ","RST","FLA"), 
            selected = "All")

# Filter by Enrollment Date

# Stor min and max dates as objects
min_enroll <- min(data$enroll_dt)
max_enroll <- max(data$enroll_dt)
sliderInput(inputId = "enroll_date",
            label = "Enrollment Date", 
            min = min_enroll,
            max = max_enroll,value = c(min_enroll, max_enroll))
```

Row  {data-height="200"}  
-----------------------------------------------------------------------  

### __Overall Accrual__

```{r}
#---- Enrollment counts for all arms

 # Count the number of distinct IDs
overall_n <- n_distinct(data$case)                  

valueBox(value = overall_n,
         caption = "Overall Accrual", 
         color = "blue")

```

### Arm 1

```{r, message=FALSE, echo=FALSE}
#---- Arm 1 enrollment  

# filter for Arm 1 cases only
# Count the number of distinct IDs
arm1_n <- data %>% filter(arm == "A: IFL") %>% with(n_distinct(case))

# Create Value box
valueBox(value = arm1_n, 
         caption = "Arm 1", 
         color = "red")
```

### Arm 2

```{r}
#---- Arm 2 enrollment  

# filter for Arm 2 cases only
# Count the number of distinct IDs
arm2_n <- data %>% filter(arm == "F: FOLFOX") %>% with(n_distinct(case))


# Create Value box
valueBox(value = arm2_n, 
         caption = "Arm 2", 
         color = "red")
```

### Arm 3

```{r}
#---- Arm 3 enrollment

# filter for Arm 3 cases only
# Count the number of distinct IDs
arm3_n <- data %>% filter(arm == "G: IROX") %>% with(n_distinct(case))

# Create Value box
valueBox(value = arm3_n, 
         caption = "Arm 3", 
         color = "red")

```


Row {data-height="800"}
-----------------------------------------------------------------------  

### Enrollment by Sex {data-width="400"}  
```{r, echo=FALSE}
ggplot(data, aes(x=sex)) + 
  geom_bar(stat="count")
```

### Enrollment by Age {data-width="600"}  
```{r, echo=FALSE}
ggplot(data, aes(x=arm, y=age,fill=arm)) +
  geom_boxplot() + 
  theme_bw() + 
  ylab("Age at Enrollment (yrs)") 
```

Surveys  
======================================================================

Row
-----------------------------------------------------------------------  

### Survey Completion Table

```{r, echo=FALSE}
#------- Survey Completion  
# Select the columns we want to show in our table
survey_table <- data %>% select(case, arm, tx_start_dt, tx_end_dt, bsl, mo3, mo6)
datatable(survey_table)
```








<!-- ----------------------------------------------------------------------------------- -->
<!-- ----------------------------------------------------------------------------------- -->
<!-- CSS - Control colors / style -->

<style>                     
.navbar-inverse {
    background-color: #ffffff; /******** navbar background color*/
        border-color: #282828; /******** navbar border color*/
}

.navbar-inverse .navbar-brand {
    color: #000000;
}

.navbar-inverse .navbar-brand:hover,
.navbar-inverse .navbar-brand:focus {
    color:  #0d0d0d;
        background-color: transparent;
}

.navbar-inverse .navbar-text {
    color: #777;
}

.navbar-inverse .navbar-nav > li > a {
    color: #777;
}

.navbar-inverse .navbar-nav > li > a:hover,
.navbar-inverse .navbar-nav > li > a:focus {
    color: #0d0d0d;
        background-color: transparent;
}

.navbar-inverse .navbar-nav > .active > a,
.navbar-inverse .navbar-nav > .active > a:hover,
.navbar-inverse .navbar-nav > .active > a:focus {
    color: #555;
        background-color: #FFFFFF;   /********* tab background color*/
}

body {
    padding-top: 60px;
    background: #ffffff;  /********* body background color*/
}

.section.sidebar {
    top: 51px;
    
/* background-color: #f5f5f5; */
    background-color: #ffffff;  /********* sidebar background color*/
    border-color: transparent;  
}

.value-box {
    color: #ffffff;     /********* valuebox text color*/
}

.bg-primary {
    background-color: #16314b; /********* valuebox background color*/
}

</style>
    